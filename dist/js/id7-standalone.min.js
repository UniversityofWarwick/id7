/*!
 * University of Warwick ID7
 */
!function(a){"use strict";var b={Template:_.template(['<div class="account-info row">','<div class="col-xs-4">','<img class="photo" src="<%- photo %>">',"</div>",'<div class="col-xs-8">','<div class="full-name"><%= fullName %></div>','<div class="email"><%= email %></div>','<div class="user-id"><%= userId %></div>','<div class="description"><%= description %></div>',"</div>","</div>",'<div class="row actions">','<div class="btn-group btn-group-justified">','<div class="btn-group">','<button data-action="change-password" type="button" class="btn btn-default">Change password</button></div>','<div class="btn-group">','<button data-action="sign-out" type="button" class="btn btn-default">Sign out</button>',"</div>","</div>","</div>"].join("")),Defaults:{container:!1,template:['<div class="popover account-information">','<div class="arrow"></div>','<div class="popover-inner">','<div class="popover-content"><p></p></div>',"</div>","</div>"].join("")}},c=function(){function c(c){c=a.extend({},b.Defaults,c),this.$trigger=c.trigger,this.options=c,this.wireEventHandlers()}return a.extend(c.prototype,{wireEventHandlers:function(){var c=this.$trigger,d=this.options.user;c.on("click",function(a){return a.preventDefault(),a.stopPropagation(),!1}).popover({container:this.options.container,content:b.Template(d),template:this.options.template,html:!0,placement:"bottom",title:"Account information",trigger:"click"}),a("html").on("click.popoverDismiss",function(b){0===a(b.target).closest(".popover").length&&0===a(b.target).closest(".use-popover").length&&c.popover("hide")})}}),c}();a.fn.accountPopover=function(b){function d(d,e){var f=a(e),g=new c(a.extend(b,{trigger:f}));f.data("id7.account-popover",g)}return b=b||{},this.each(d)},a(function(){a('[data-toggle="id7:account-popover"]').accountPopover({user:{photo:"http://www.gravatar.com/avatar/ed08722fea72ddf208e404d92c20b01d",fullName:"Mathew Mannion",email:"M.Mannion@warwick.ac.uk",userId:"u0672089",description:"Staff, IT Services"}})})}(jQuery),function(a){"use strict";var b={Breadcrumbs:{ICON_OPEN:"active",ICON_CLOSED:""},ScreenSizes:[{name:"lg",test:function(){return window.matchMedia("(min-width: 1200px)").matches},container:1170},{name:"md",test:function(){return window.matchMedia("(min-width: 992px)").matches},container:970},{name:"sm",test:function(){return window.matchMedia("(min-width: 768px)").matches},container:750},{name:"xs",test:function(){return!0}}],Templates:{moreContainer:['<ul class="nav navbar-nav navbar-right">','<li class="dropdown">','<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-bars"></i></a>','<ul class="dropdown-menu" role="menu"></ul>',"</li>","</ul>"].join(""),moreBreadcrumbsContainer:['<li class="nav-breadcrumb dropdown">','<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>','<ul class="dropdown-menu" role="menu"></ul>',"</li>"].join("")},Defaults:{fixed:!0,flipBreadcrumbIcons:!0,fitToWidth:!0,collapseSmallscreen:!1,trimLinkTitles:{maxLength:60,append:"&hellip;"}}},c=function(){function c(c){c=a.extend({},b.Defaults,c),this.$container=c.container,c.trimLinkTitles&&"object"!=typeof c.trimLinkTitles&&(c.trimLinkTitles=a.extend({},b.Defaults.trimLinkTitles)),this.options=c,c.trimLinkTitles&&this.trimLinkTitles(),c.fixed&&this.affix(),c.flipBreadcrumbIcons&&this.flipBreadcrumbIcons(),c.fitToWidth&&this.onScreenResize(),this.wireEventHandlers()}return a.extend(c.prototype,{trimLinkTitles:function(){var b=this.options.trimLinkTitles;this.$container.find(".nav a").filter(function(){return a.trim(a(this).text()).length>b.maxLength}).each(function(){var c=a(this),d=a.trim(c.text()),e=d.split(/\s+/g),f=[];a.each(e,function(a,c){var d=f.join(" ");return(d+" "+c).length>b.maxLength?!1:void f.push(c)}),c.attr("title",d).text(f.join(" ")).append(b.append)})},affix:function(){this.$container.affix({offset:{top:this.$container.offset().top-a("#id7-utility-bar").height()}})},flipBreadcrumbIcons:function(){this.$container.find(".navbar-brand[data-target]").each(function(){var c=a(this),d=c.find(".fa").addClass(b.Breadcrumbs.ICON_CLOSED),e=a(c.attr("data-target"));e.on("show.bs.collapse",function(){d.removeClass(b.Breadcrumbs.ICON_CLOSED).addClass(b.Breadcrumbs.ICON_OPEN)}),e.on("hide.bs.collapse",function(){d.removeClass(b.Breadcrumbs.ICON_OPEN).addClass(b.Breadcrumbs.ICON_CLOSED)})})},_screenConfig:function(){return _.find(b.ScreenSizes,function(a){return a.test()})},onScreenResize:function(){var a=this._screenConfig();("xs"===a.name||a.name!==this.lastScreenConfig)&&(this.options.fitToWidth&&this.fitToWidth(a),this.lastScreenConfig=a.name)},fitToWidth:function(c){var d=this.options;this.$container.find(".navbar:not(.navbar-breadcrumbs)").each(function(){var e=a(this),f=e.find("> .nav").first(),g=e.find("> .navbar-right"),h=f.find("> li.nav-breadcrumb.dropdown");g.find("> .dropdown > .dropdown-menu > li").each(function(){var b=a(this);f.append(b)}),0===g.length&&(g=a(b.Templates.moreContainer),e.append(g)),g.addClass("hidden"),h.find("> .dropdown-menu > li").each(function(){var b=a(this);h.after(b)});var i=f.find("> li.nav-breadcrumb:not(.active):not(.dropdown)");if(i.length>0&&0===h.length&&(h=a(b.Templates.moreBreadcrumbsContainer),f.prepend(h)),h.addClass("hidden"),!d.collapseSmallscreen||"xs"!=c.name){var j=function(){return _.some(_.union(f.find("> li").get(),g.get()),function(b){return a(b).is(":visible")&&a(b).position().top>0})};if(j()&&i.length>0&&(h.removeClass("hidden"),f.find("> li.nav-breadcrumb:not(.active):not(.dropdown)").each(function(){h.find("> .dropdown-menu").append(a(this).css("height",""))})),j()){g.removeClass("hidden");do g.find("> .dropdown > .dropdown-menu").prepend(f.find("> li:not(.nav-breadcrumb)").last().css("height",""));while(j()&f.find("> li:not(.nav-breadcrumb)").length>0)}}})},wireEventHandlers:function(){this.options.fitToWidth&&a(window).on("resize.id7.navigation.onScreenResize",a.proxy(this.onScreenResize,this)),this.$container.on("click",".nav > li",function(b){var c=a(b.target).closest("a");if(!(c.length>0))return c=a(this).find("a").first(),c.length>0?(b.stopPropagation(),b.preventDefault(),c[0].click(),!1):void 0})}}),c}();a.fn.id7Navigation=function(b){function d(d,e){var f=a(e),g=new c(a.extend(b,{container:f}));f.data("id7.navigation",g)}return b=b||{},this.each(d)},a(function(){a("#id7-navigation").id7Navigation()})}(jQuery),function(a){"use strict";var b=function(){function a(a){a=a||{};var b=a.input;b.typeahead({minLength:a.minLength,hint:a.hint},{name:a.name,source:a.source,displayKey:a.displayKey,templates:a.templates})}return a}();a.fn.searchSuggest=function(c){function d(d,e){var f=a(e),g=new b(a.extend(c,{input:f}));f.data("id7.search-suggest",g)}return c=c||{},this.each(d)},a(function(){a('input[data-suggest="go"]').each(function(b,c){a(c).searchSuggest({name:"go",source:function(b,c){a.getJSON("//sitebuilder.warwick.ac.uk/sitebuilder2/api/go/redirects.json?maxResults=6&prefix="+encodeURIComponent(b)+"&callback=?",c)},displayKey:"path",minLength:2,hint:!1,templates:{suggestion:_.template(['<p class="go-path"><%= path %></p>','<p class="go-description"><% if (typeof description !== "undefined") { print(description); } %></p>'].join(""))}});var d=a(c).data("ttTypeahead");d.input.onSync("queryChanged",function(b,d){a(c).data("original-query",d)}),a(c).on("typeahead:selected",function(b,c){window.location="http://go.warwick.ac.uk/"+c.path+"?goSearchReferer="+encodeURIComponent(window.location)+"&goSearchQuery="+encodeURIComponent(a(this).data("original-query"))})})})}(jQuery);