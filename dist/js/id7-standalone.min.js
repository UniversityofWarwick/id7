/*!
 * University of Warwick ID7
 */
!function(a){"use strict";var b={Defaults:{screenSizes:[{name:"lg",test:function(){return Modernizr.mq("only all and (min-width: 1200px)")},container:1170},{name:"md",test:function(){return Modernizr.mq("only all and (min-width: 992px)")},container:970},{name:"sm",test:function(){return Modernizr.mq("only all and (min-width: 768px)")},container:750},{name:"xs",test:function(){return!0}}],eventName:"id7:reflow"}},c=function(){function c(c){c=a.extend({},b.Defaults,c),this.options=c,this.onScreenResize(),this.wireEventHandlers()}return a.extend(c.prototype,{_screenConfig:function(){return _.find(this.options.screenSizes,function(a){return a.test()})},onScreenResize:function(a,b){var c=this._screenConfig();(b||"xs"===c.name||c.name!==this.lastScreenConfig)&&(this.options.container.trigger(this.options.eventName,[c]),this.lastScreenConfig=c.name)},reflow:function(){this.onScreenResize({},!0)},wireEventHandlers:function(){a(window).on("resize.id7.reflow.onScreenResize",a.proxy(this.onScreenResize,this)),"complete"===document.readyState?this.reflow():a(window).on("load",a.proxy(this.reflow,this))}}),c}();a.fn.reflow=function(b){function d(d,e){var f=a(e),g=f.data("id7.reflow"),h=a.extend({},f.data(),{container:f},"object"==typeof b&&b);g||f.data("id7.reflow",g=new c(h)),"reflow"!==b&&"force"!==b&&!0!==b||g.reflow()}return this.each(d)},a(function(){a(window).reflow()})}(jQuery),function(a){"use strict";function b(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var c={Templates:{Popover:function(a){return'<div class="account-info"><iframe src="'+b(a.useMwIframe?a.iframelink+"?embedded":a.legacyIframeLink)+'" scrolling="auto" frameborder="0" allowtransparency="true" seamless sandbox="allow-same-origin allow-scripts allow-top-navigation allow-forms allow-popups"></iframe></div><div class="actions"><div class="btn-group btn-group-justified"><div class="btn-group sign-out"><a href="'+b(a.logoutlink)+'" class="btn btn-default">Sign out</a></div></div></div>'},Action:function(a){return'<div class="btn-group"><a href="'+b(a.href)+'" title="'+b(a.tooltip)+'" class="btn btn-default '+b(a.classes)+'">'+b(a.title)+"</a></div>"}},Defaults:{container:!1,iframelink:"https://my.warwick.ac.uk/",notificationsApi:"https://my.warwick.ac.uk/api/id7/notifications/unreads",legacyIframeLink:"https://websignon.warwick.ac.uk/origin/account/popover",showNotificationsBadge:!0,useMwIframe:!0,maxNumberNotifications:99,template:['<div class="popover my-warwick hybrid-overlay">','<div class="arrow"></div>','<div class="popover-inner">','<div class="popover-content"><p></p></div>',"</div>","</div>"].join("")},MessagePrefix:"message.id7.account-popover."},d=function(b,c,d){a.ajax({url:b,success:c,error:d,dataType:"json",xhrFields:{withCredentials:!0}})},e=function(){function b(b){b=a.extend({},c.Defaults,b),this.$trigger=b.trigger,this.options=b,void 0===this.options.logoutlink&&(this.options.logoutlink=this.$trigger.attr("href")),this.wireEventHandlers()}return a.extend(b.prototype,{createPopover:function(a){var b={container:this.options.container,content:c.Templates.Popover(this.options),template:this.options.template,html:!0,placement:"bottom",title:"Account information",trigger:"manual"};a.popover(b)},isBlacklistedDevice:function(){return-1!==navigator.userAgent.indexOf("iPad")},isMwFeatureAvailable:function(){return!this.isBlacklistedDevice()},wireEventHandlers:function(){var b=this.$trigger,e=this,f=this.options.iframelink;if(this.options.name){var g='<span class="fa-stack id7-notifications-badge">  <i class="fa fa-circle fa-stack-2x"></i>  <strong class="fa-stack-1x fa fa-spinner fa-spin brand-text counter-value"></strong> </span>';this.isMwFeatureAvailable()&&this.options.showNotificationsBadge||(g=""),b.html(this.options.name+g+'<span class="caret"></span>')}var h=b.find(".id7-notifications-badge");b.on("click",function(a){return a.preventDefault(),a.stopPropagation(),b.popover("toggle"),h.find(".counter-value:not(.fa-exclamation-triangle):not(.fa-spinner)").text("0"),e.options.iframelink=f,b.data("bs.popover").options.content=c.Templates.Popover(e.options),h.removeClass("animating"),b.blur(),!1}),this.createPopover(b),this.options.showNotificationsBadge&&this.isMwFeatureAvailable()&&d(this.options.notificationsApi,function(a){var d=Math.min(a.unreads,99);h.find(".counter-value").removeClass("fa-spinner").removeClass("fa-spin").addClass("slideInDown").text(d),d>0&&(h.fadeIn().addClass("animating"),e.options.iframelink=f+"alerts",b.data("bs.popover").options.content=c.Templates.Popover(e.options))},function(){h.find(".counter-value").removeClass("fa-spinner").removeClass("fa-spin").addClass("fa-exclamation-triangle"),h.attr("title","There was a problem communicating with the MyWarwick notifications service")}),a("html").on("click.popoverDismiss",function(c){var d=a(c.target);0===d.closest(".popover").length&&0===d.closest(".use-popover").length&&0===d.closest(b).length&&b.popover("hide")});var i=a.proxy(function(d,e){if(this.options.useMwIframe="xs"!==e.name&&a(window).height()>=580&&this.isMwFeatureAvailable(),b.find(".id7-notifications-badge").toggle(this.options.useMwIframe),void 0!==b.data("bs.popover")){b.data("bs.popover").options.content=c.Templates.Popover(this.options);var f=this.options.useMwIframe&&this.isMwFeatureAvailable()?"my-warwick":"account-information",g=b.data("bs.popover");g.tip().removeClass("account-information","my-warwick").addClass(f),g.tip().hasClass("in")&&(b.popover("show"),b.next(".popover").removeClass("loading"))}},this);if(a(window).on("id7:reflow",i),"complete"===document.readyState&&void 0!==a(window).data("id7.reflow")){i({},a(window).data("id7.reflow")._screenConfig())}},onMessage:function(a,b){var d=this.$trigger.next(".popover");switch(a){case"addAction":_.defaults(b,{classes:"",tooltip:""}),d.find(".actions > .btn-group").prepend(c.Templates.Action(b)),d.find(".actions > .btn-group > .btn-group").first().find('[title]:not([title=""])').tooltip({placement:"bottom"});break;case"resizeIframe":d.find(".account-info iframe").height(b.height);break;case"layoutDidMount":d.addClass("loaded"),this.updateColourTheme(b.colourTheme);break;case"colourThemeChange":this.updateColourTheme(b.colourTheme);break;case"signedOut":var e=this.options.loginlink;d.find(".actions > .btn-group > .sign-out").replaceWith(c.Templates.Action({href:e,classes:"sign-in",title:"Sign in",tooltip:""}));break;default:console.error("Unexpected message type: "+a)}},updateColourTheme:function(b){this.$trigger.next(".popover").removeClass(function(b,c){return a.grep(c.split(" "),function(a){return 0===a.indexOf("theme-")}).join(" ")}).addClass("theme-"+b)}}),b}();a.fn.accountPopover=function(b){function c(c,d){var f=a(d),g=new e(a.extend({},f.data(),b,{trigger:f}));f.data("id7.account-popover",g)}return b=b||{},this.each(c)},a(function(){a('[data-toggle="id7:account-popover"]').accountPopover(),a(window).on("message",function(b){var d=b.originalEvent.origin;try{var e=JSON.parse(b.originalEvent.data);if(e.type&&0===e.type.indexOf(c.MessagePrefix)){var f=e.type.substring(c.MessagePrefix.length);a('[data-toggle="id7:account-popover"]').each(function(){var b=a(this),c=b.data("id7.account-popover");0!==c.options.iframelink.indexOf(d)&&0!==c.options.legacyIframeLink.indexOf(d)?console.error("Ignored message of type "+f+" because origin "+d+" didn't match iframe link "+c.options.iframelink):c.onMessage(f,e)})}}catch(g){}})})}(jQuery),function(a){"use strict";var b={ScreenSizes:[{name:"lg",test:function(){return Modernizr.mq("only all and (min-width: 1200px)")},container:1170},{name:"md",test:function(){return Modernizr.mq("only all and (min-width: 992px)")},container:970},{name:"sm",test:function(){return Modernizr.mq("only all and (min-width: 768px)")},container:750},{name:"xs",test:function(){return!0}}],Templates:{moreContainer:['<ul class="nav navbar-nav navbar-right">','<li class="dropdown">','<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-caret-down"></i></a>','<ul class="dropdown-menu" role="menu"></ul>',"</li>","</ul>"].join(""),marker:'<div class="id7-navigation-marker"></div>'},Defaults:{fixedHeader:!0,fixedNav:!0,fitToWidth:!1,collapseSmallscreen:!1,trimLinkTitles:{maxLength:60,append:"&hellip;"}},HeadroomEvents:{onPin:function(){a(this.elem).trigger("id7:headroom:onPin")},onUnpin:function(){a(this.elem).trigger("id7:headroom:onUnpin")}}},c=function(){function c(c){c=a.extend({},b.Defaults,c),this.$container=c.container,c.trimLinkTitles&&"object"!=typeof c.trimLinkTitles&&(c.trimLinkTitles=a.extend({},b.Defaults.trimLinkTitles)),this.options=c,this.options.fixedHeader&&this.markHeaderFixedPosition(),this.options.fixedNav&&this.markFixedPosition(),c.trimLinkTitles&&this.trimLinkTitles(),this.wireEventHandlers()}return a.extend(c.prototype,{trimLinkTitles:function(){var b=this.options.trimLinkTitles;this.$container.find(".nav a").filter(function(){return a.trim(a(this).text()).length>b.maxLength}).each(function(){var c=a(this),d=a.trim(c.text()),e=d.split(/\s+/g),f=[];a.each(e,function(a,c){if((f.join(" ")+" "+c).length>b.maxLength)return!1;f.push(c)}),c.attr("title",d).text(f.join(" ")).append(b.append)})},affixHeader:function(){var c=a(".id7-header-text h1");if(c.length){this.markHeaderFixedPosition();var d=a(".id7-header-text").offset().top,e=d;a(".id7-main-content-area").length>0&&(e=a(".id7-main-content-area").offset().top);var f=a.extend(b.HeadroomEvents,{offset:e});c.affix({offset:{top:d}}).headroom(f)}},affixNav:function(){var c,d=this.$container,e=a(".id7-header-text h1");c=e.length?e.offset().top:d.offset().top;var f=c;a(".id7-main-content-area").length>0&&(f=a(".id7-main-content-area").offset().top);var g=a.extend(b.HeadroomEvents,{offset:f});d.affix({offset:{top:c}}).headroom(g)},fitToWidth:function(c){var d=this.options;this.$container.find(".navbar:not(.navbar-secondary)").each(function(){var e=a(this),f=e.find("> .nav").first(),g=e.find("> .navbar-right");if(g.find("> .dropdown > .dropdown-menu > li").each(function(){var b=a(this);f.append(b)}),0===g.length&&(g=a(b.Templates.moreContainer),e.append(g)),g.addClass("hidden"),!d.collapseSmallscreen||"xs"!=c.name){var h=function(){return _.some(_.union(f.find("> li").get(),g.get()),function(b){return a(b).is(":visible")&&a(b).position().top>0})};if(h()){g.removeClass("hidden");do{g.find("> .dropdown > .dropdown-menu").prepend(f.find("> li:not(.nav-breadcrumb)").last().css("height",""))}while(h()&f.find("> li:not(.nav-breadcrumb)").length>0);var i=g.find("> .dropdown");i.toggleClass("active",i.find("li.active").length>0)}}})},updateWrappedState:function(){this.$container.find(".navbar").each(function(){var b=a(this),c=b.hasClass("navbar-wrapped"),d=b.find("> .nav > li:last"),e=d.length&&d.position().top>0;e!=c&&(b.addClass("important-no-transition"),b.toggleClass("navbar-wrapped",e),_.defer(function(){b.removeClass("important-no-transition")}))})},updateDropdownBehaviour:function(b){this.$container.find(".navbar").each(function(){var c=a(this);"xs"===b.name?c.find(".dropdown-toggle").attr("data-toggle","dropdown").attr("role","button").attr("aria-expanded",!1):c.find(".dropdown-toggle").removeAttr("data-toggle").removeAttr("role").removeAttr("aria-expanded").parent().removeClass("open")})},getAffixedHeight:function(){var b=0;return this.options.fixedHeader&&(b+=a(".id7-header-text h1").outerHeight()),this.options.fixedNav&&(b+=this.$container.outerHeight()),b},hashChanged:function(){var a=this.getAffixedHeight();setTimeout(function(){window.scrollBy(0,-a)},1)},markHeaderFixedPosition:function(){a(".id7-header-text").css("height","");var b=a(".id7-header-text h1"),c=b.hasClass("affix");c&&b.removeClass("affix"),a(".id7-header-text").height(a(".id7-header-text").height()),c&&b.addClass("affix")},markFixedPosition:function(){var c=this.$container.next(".id7-navigation-marker");0===c.length&&(c=a(b.Templates.marker),this.$container.after(c)),c.height(this.$container.height())},wireEventHandlers:function(){"complete"===document.readyState?(this.options.fixedNav&&this.affixNav(),this.options.fixedHeader&&this.affixHeader(),this.updateWrappedState()):a(window).on("load",a.proxy(function(){this.options.fixedNav&&this.affixNav(),this.options.fixedHeader&&this.affixHeader(),this.updateWrappedState()},this));var b=a.proxy(function(a,b){this.options.fitToWidth&&this.fitToWidth(b),this.options.fixedHeader&&this.markHeaderFixedPosition(),this.options.fixedNav&&this.markFixedPosition(),this.updateWrappedState(),this.updateDropdownBehaviour(b)},this);if(a(window).on("id7:reflow",b),"complete"===document.readyState&&void 0!==a(window).data("id7.reflow")){b({},a(window).data("id7.reflow")._screenConfig())}this.$container.on("click",".nav > li",function(b){var c=a(b.target).closest("a");if(!(c.length>0))return c=a(this).find("a").first(),c.length>0?(b.stopPropagation(),b.preventDefault(),c[0].click(),!1):void 0}),location.hash&&this.hashChanged(),a(window).on("hashchange",a.proxy(this.hashChanged,this))}}),c}();a.fn.id7Navigation=function(b){function d(d,e){var f=a(e),g=new c(a.extend({},f.data(),b,{container:f}));f.data("id7.navigation",g)}return b=b||{},this.each(d)},a(function(){a(".id7-navigation").id7Navigation();var b=document.location.toString();if(b.match("#")&&b.split("#")[1].length){var c=a('.nav-tabs a[href="#'+b.split("#")[1]+'"]');c&&c.tab("show")}a(".nav-tabs a").on("shown.bs.tab.id7Navigation",function(a){window.location.hash=a.target.hash})})}(jQuery),function(a){"use strict";var b=function(){function a(a){a=a||{},a.input.typeahead({minLength:a.minLength,hint:a.hint},{name:a.name,source:a.source,display:a.display,templates:a.templates,async:!0,limit:1e3}).on("keydown",function(a){switch(a.which||a.keyCode){case 38:case 40:a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||a.stopPropagation()}})}return a}();a.fn.searchSuggest=function(c){function d(d,e){var f=a(e),g=new b(a.extend({},f.data(),c,{input:f}));f.data("id7.search-suggest",g)}return c=c||{},this.each(d)},a(function(){function b(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}a('input[data-suggest="go"]').each(function(c,d){a(d).next(".fa").on("click",function(b){b.preventDefault(),b.stopPropagation(),a(d).closest("form").submit()});var e=3,f=3;Modernizr.mq("only all and (min-width: 768px)")&&(e=2,f=6),a(d).searchSuggest({name:"go",source:function(b,c,d){a.getJSON("//sitebuilder.warwick.ac.uk/sitebuilder2/api/go/redirects.json?maxResults="+f+"&prefix="+encodeURIComponent(b)+"&callback=?",d)},display:"path",minLength:e,hint:!1,templates:{suggestion:function(a){return'<div><p class="go-path">'+b(a.path)+'</p><p class="go-description">'+(void 0!==a.description?b(a.description):"")+"</p></div>"}}}),a(d).data("ttTypeahead").input.onSync("queryChanged",function(b,c){a(d).data("original-query",c)}),a(d).on("typeahead:select",function(b,c){window.location="http://go.warwick.ac.uk/"+c.path+"?goSearchReferer="+encodeURIComponent(window.location)+"&goSearchQuery="+encodeURIComponent(a(this).data("original-query"))}),a(d).width()<88&&a(d).attr("placeholder","Search")})})}(jQuery),function(a){"use strict";var b={Templates:{PopoutLink:['<span class="id7-table-wrapper-popout">',"(",'<a href="#" data-toggle="id7:popout-table">',"Pop-out table","</a>",")","</span>"].join(""),Modal:['<div class="id7-wide-table-popout-modal modal fade" tabindex="-1" role="dialog" aria-hidden="true">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><span class="modal-title">&nbsp;</span></div><div class="modal-body"></div>',"</div>","</div>","</div>"].join("")},Defaults:{container:"id7-wide-table-wrapper-container",wrapper:"table-responsive",popout:function(){return Modernizr.mq("only all and (min-width: 768px)")},doublescroll:!0}},c=function(){function c(c){function d(d,f){var g=a(f),h=a.extend({},c,g.data());if(h.wrapper&&"string"!=typeof h.wrapper&&(h.wrapper=b.Defaults.wrapper),h.container&&"string"!=typeof h.container&&(h.container=b.Defaults.container),h.wrapper){e.wrap(g,h.wrapper,h.container);var i=g.parent(),j=i.parent(),k=h.popout,l=h.doublescroll;"function"==typeof h.popout&&(k=h.popout()),"function"==typeof h.doublescroll&&(k=h.doublescroll()),k&&e.popout(g,i,j),l&&e.doubleScroll(g,i)}}c=a.extend({},b.Defaults,c);var e=this;e.findWideTables(c.container).each(d)}return a.extend(c.prototype,{findWideTables:function(b){return b.find("table").filter(function(){return 0===a(this).parents(".no-wide-tables").length}).filter(function(){var b=a(this),c=b.css("max-width");b.css("max-width","none");var d=!b.data("id7.wide-tables.wrapped")&&Math.floor(b.width())>b.parent().width();return b.css("max-width",c),d})},wrap:function(b,c,d){return b.wrap(a("<div />").addClass(d).append(a("<div />").addClass(c))).data("id7.wide-tables.wrapped",!0),b.parent()},popout:function(c,d,e){if(c.is(":visible")&&!c.hasClass("sb-no-wrapper-table-popout")){e.prepend(b.Templates.PopoutLink).append(b.Templates.PopoutLink);var f=a(a.parseHTML(b.Templates.Modal)).appendTo(document.body);e.on("click",'[data-toggle="id7:popout-table"]',function(a){return a.stopPropagation(),a.preventDefault(),f.find(".modal-body").html(d.html()),f.modal().modal("show"),!1})}return c},doubleScroll:function(a,b){return b.doubleScroll(),a}}),c}();a.fn.wideTables=function(b){function d(d,e){var f=a(e),g=new c(a.extend({},f.data(),b,{container:f}));f.data("id7.wide-tables",g)}return b=b||{},this.each(d)},a(window).on("load id7:ready",function(){a(".id7-main-content").wideTables()}),a(function(){a(window).trigger("id7:ready")})}(jQuery),function(){"use strict";Modernizr.addTest("safari",function(){var a=window.navigator.userAgent;return a.indexOf("Safari/")>=0&&-1==a.indexOf("Chrome/")})}(),function(){"use strict";Modernizr.addTest("ie-or-edge",function(){var a=window.navigator.userAgent;return/MSIE 10/i.test(a)||/MSIE 9/i.test(a)||/rv:11.0/i.test(a)||/Edge\/\d./i.test(a)})}(),/*!
 * IE10 viewport hack for Surface/desktop Windows 8 bug
 * Copyright 2014 Twitter, Inc.
 * Licensed under the Creative Commons Attribution 3.0 Unported License. For
 * details, see http://creativecommons.org/licenses/by/3.0/.
 */
function(){"use strict";if(navigator.userAgent.match(/IEMobile\/10\.0/)){var a=document.createElement("style");a.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.querySelector("head").appendChild(a)}}();
//# sourceMappingURL=id7-standalone.min.js.map